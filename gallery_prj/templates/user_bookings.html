{% extends 'base.html' %}
{% load static %}

{% block title %}–ú–æ–∏ –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏—è{% endblock %}
{% block body_class %}my-bookings-page{% endblock %}
<head>
    <link rel="stylesheet" href="{% static 'styles.css' %}">
</head>
    {% block content %}
<div class="bookings-container">
    <div class="bookings-header">
        <h1 class="bookings-title">–ú–æ–∏ –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏—è</h1>
       <a href="/booking/create/" class="new-booking-btn">
            <span class="btn-icon">+</span>
            –ù–æ–≤–æ–µ –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ
        </a>
    </div>
    
    <!-- –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ -->
    <div class="bookings-stats">
        <div class="stat-card">
            <div class="stat-icon">üìÖ</div>
            <div class="stat-content">
                <h3>{{ stats.total }}</h3>
                <p>–í—Å–µ–≥–æ –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–π</p>
            </div>
        </div>
        
        <div class="stat-card">
            <div class="stat-icon">‚è≥</div>
            <div class="stat-content">
                <h3>{{ stats.pending }}</h3>
                <p>–û–∂–∏–¥–∞—é—Ç –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è</p>
            </div>
        </div>
        
        <div class="stat-card">
            <div class="stat-icon">‚úÖ</div>
            <div class="stat-content">
                <h3>{{ stats.confirmed }}</h3>
                <p>–ü–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–æ</p>
            </div>
        </div>
        
        <div class="stat-card">
            <div class="stat-icon">üéØ</div>
            <div class="stat-content">
                <h3>{{ stats.upcoming }}</h3>
                <p>–ü—Ä–µ–¥—Å—Ç–æ—è—â–∏–µ</p>
            </div>
        </div>
    </div>
    
    <!-- –§–∏–ª—å—Ç—Ä—ã -->
    <div class="bookings-filters">
        <div class="filter-tabs">
            <a href="/booking/my/" class="filter-tab {% if not status_filter %}active{% endif %}">
                –í—Å–µ
            </a>
            <a href="/booking/my/?status=pending" class="filter-tab {% if status_filter == 'pending' %}active{% endif %}">
                –û–∂–∏–¥–∞—é—Ç ({{ stats.pending }})
            </a>
           <a href="/booking/my/?status=confirmed" class="filter-tab {% if status_filter == 'confirmed' %}active{% endif %}">
                –ü–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω—ã ({{ stats.confirmed }})
            </a>
            <a href="/booking/my/?status=completed" class="filter-tab {% if status_filter == 'completed' %}active{% endif %}">
                –í—ã–ø–æ–ª–Ω–µ–Ω—ã
            </a>
             <a href="/booking/my/?status=cancelled" class="filter-tab {% if status_filter == 'cancelled' %}active{% endif %}">
                –û—Ç–º–µ–Ω–µ–Ω—ã
            </a>
        </div>
    </div>
    
    <!-- –°–ø–∏—Å–æ–∫ –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–π -->
    {% if page_obj.object_list %}
    <div class="bookings-list">
        {% for booking in page_obj.object_list %}
        <div class="booking-card booking-card-{{ booking.status }}">
            <div class="booking-card-header">
                <div class="booking-id">#{{ booking.id|slice:":8" }}</div>
                <div class="booking-status status-{{ booking.status }}">
                    {{ booking.get_status_display }}
                </div>
            </div>
            
            <div class="booking-card-body">
                <h3 class="booking-service">{{ booking.service.name }}</h3>
                
                <div class="booking-details">
                    <div class="detail-item">
                        <span class="detail-icon">üìÖ</span>
                        <span class="detail-text">
                            {{ booking.booking_date|date:"d.m.Y" }} –≤ {{ booking.booking_time|time:"H:i" }}
                        </span>
                    </div>
                    
                    <div class="detail-item">
                        <span class="detail-icon">‚è±Ô∏è</span>
                        <span class="detail-text">{{ booking.duration }} —á–∞—Å–æ–≤</span>
                    </div>
                    
                    {% if booking.location %}
                    <div class="detail-item">
                        <span class="detail-icon">üìç</span>
                        <span class="detail-text">{{ booking.location }}</span>
                    </div>
                    {% endif %}
                    
                    <div class="detail-item">
                        <span class="detail-icon">üí∞</span>
                        <span class="detail-text">{{ booking.get_total_price }} —Ä—É–±.</span>
                    </div>
                </div>
                
                {% if booking.client_message %}
                <div class="booking-message">
                    <strong>–í–∞—à–∏ –ø–æ–∂–µ–ª–∞–Ω–∏—è:</strong>
                    <p>{{ booking.client_message|truncatechars:150 }}</p>
                </div>
                {% endif %}
            </div>
            
            <div class="booking-card-footer">
                 <a href="/booking/{{ booking.id }}/" class="detail-link">
                    –ü–æ–¥—Ä–æ–±–Ω–µ–µ ‚Üí
                </a>
                <span class="booking-date">
                    –°–æ–∑–¥–∞–Ω–æ: {{ booking.created_at|date:"d.m.Y" }}
                </span>
            </div>
            
            {% if booking.status == 'pending' and booking.is_upcoming %}
            <div class="booking-card-actions">
                <a href="/booking/{{ booking.id }}/cancel/" class="cancel-link">
                    –û—Ç–º–µ–Ω–∏—Ç—å –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ
                </a>
            </div>
            {% endif %}
        </div>
        {% endfor %}
    </div>
    
    <!-- –ü–∞–≥–∏–Ω–∞—Ü–∏—è -->
    {% if page_obj.has_other_pages %}
    <div class="pagination">
        {% if page_obj.has_previous %}
            <a href="?page=1{% if status_filter %}&status={{ status_filter }}{% endif %}" class="page-link">¬´</a>
            <a href="?page={{ page_obj.previous_page_number }}{% if status_filter %}&status={{ status_filter }}{% endif %}" class="page-link">‚Äπ</a>
        {% endif %}
        
        <span class="current-page">
            –°—Ç—Ä–∞–Ω–∏—Ü–∞ {{ page_obj.number }} –∏–∑ {{ page_obj.paginator.num_pages }}
        </span>
        
        {% if page_obj.has_next %}
            <a href="?page={{ page_obj.next_page_number }}{% if status_filter %}&status={{ status_filter }}{% endif %}" class="page-link">‚Ä∫</a>
            <a href="?page={{ page_obj.paginator.num_pages }}{% if status_filter %}&status={{ status_filter }}{% endif %}" class="page-link">¬ª</a>
        {% endif %}
    </div>
    {% endif %}
    
    {% else %}
    <div class="no-bookings">
        <div class="no-bookings-icon">üìÖ</div>
        <h3>–£ –≤–∞—Å –ø–æ–∫–∞ –Ω–µ—Ç –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–π</h3>
        <p>–ó–∞–±—Ä–æ–Ω–∏—Ä—É–π—Ç–µ —Å–≤–æ—é –ø–µ—Ä–≤—É—é —Å—ä–µ–º–∫—É –ø—Ä—è–º–æ —Å–µ–π—á–∞—Å!</p>
        <a href="/booking/create/" class="cta-button">
            –ó–∞–±—Ä–æ–Ω–∏—Ä–æ–≤–∞—Ç—å —Å—ä–µ–º–∫—É
        </a>
    </div>
    {% endif %}
</div>
{% endblock %}

{% block extra_css %}
{% endblock %}