{% extends 'base.html' %}
{% load static %}

{% block title %}–ë—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ —É—Å–ª—É–≥–∏{% endblock %}
{% block body_class %}booking-page{% endblock %}

{% block content %}
<div class="booking-container">
    <div class="booking-form-wrapper">
        <div class="booking-form-container">
            <h1 class="booking-title">–ë—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ —É—Å–ª—É–≥–∏</h1>
            <p class="booking-subtitle">–ó–∞–ø–æ–ª–Ω–∏—Ç–µ —Ñ–æ—Ä–º—É –Ω–∏–∂–µ –¥–ª—è –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏—è —Å—ä–µ–º–∫–∏</p>

            <form method="post" class="booking-form" id="bookingForm">
                {% csrf_token %}

                {% if form.errors %}
                <div class="error-message">
                    <div class="error-icon">‚ö†Ô∏è</div>
                    <div class="error-content">
                        <h4>–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –∏—Å–ø—Ä–∞–≤—å—Ç–µ –æ—à–∏–±–∫–∏:</h4>
                        <ul>
                            {% for field in form %}
                                {% for error in field.errors %}
                                    <li>{{ field.label }}: {{ error }}</li>
                                {% endfor %}
                            {% endfor %}
                            {% for error in form.non_field_errors %}
                                <li>{{ error }}</li>
                            {% endfor %}
                        </ul>
                    </div>
                </div>
                {% endif %}

                <!-- –í—ã–±–æ—Ä —É—Å–ª—É–≥–∏ -->
                <div class="form-section">
                    <h3 class="section-title">–í—ã–±–µ—Ä–∏—Ç–µ —É—Å–ª—É–≥—É</h3>
                    <div class="services-grid">
                        {% for service in form.service.field.queryset %}
                        <label class="service-option">
                            <input type="radio" name="service" value="{{ service.id }}"
                                   class="service-radio" id="service_{{ service.id }}"
                                   {% if form.service.value == service.id %}checked{% endif %}>
                            <div class="service-content">
                                <div class="service-icon">
                                    {% if service.service_type == 'PHOTO' %}üì∑
                                    {% elif service.service_type == 'VIDEO' %}üé•
                                    {% elif service.service_type == 'EDITING' %}üíª
                                    {% else %}‚ú®{% endif %}
                                </div>
                                <h4>{{ service.name }}</h4>
                                <p class="service-price">{{ service.price }} —Ä—É–±.</p>
                                <p class="service-duration">{{ service.duration }}</p>
                            </div>
                        </label>
                        {% empty %}
                        <p class="no-services">–ù–µ—Ç –¥–æ—Å—Ç—É–ø–Ω—ã—Ö —É—Å–ª—É–≥ –¥–ª—è –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏—è.</p>
                        {% endfor %}
                    </div>
                    {% if form.service.errors %}
                    <div class="field-error">{{ form.service.errors }}</div>
                    {% endif %}
                </div>

                <!-- –î–∞—Ç–∞ –∏ –≤—Ä–µ–º—è -->
                <div class="form-section">
                    <h3 class="section-title">–î–∞—Ç–∞ –∏ –≤—Ä–µ–º—è —Å—ä–µ–º–∫–∏</h3>

                    <div class="date-selection">
                        <div class="section-subtitle">–î–æ—Å—Ç—É–ø–Ω—ã–µ –¥–∞—Ç—ã</div>
                        <div class="available-dates">
                            {% for date in available_dates %}
                            <label class="date-option">
                                <input type="radio" name="booking_date" value="{{ date|date:'Y-m-d' }}"
                                       class="date-radio" id="date_{{ forloop.counter }}"
                                       {% if form.booking_date.value == date|date:'Y-m-d' %}checked{% endif %}>
                                <div class="date-content">
                                    <span class="day">{{ date|date:'d' }}</span>
                                    <span class="month">{{ date|date:'M' }}</span>
                                    <span class="weekday">{{ date|date:'D' }}</span>
                                </div>
                            </label>
                            {% endfor %}
                        </div>
                        {% if form.booking_date.errors %}
                        <div class="field-error">{{ form.booking_date.errors }}</div>
                        {% endif %}

                        <div class="time-fields">
                            <div class="form-row">
                                <div class="form-group">
                                    <label for="{{ form.booking_time.id_for_label }}" class="form-label">–í—Ä–µ–º—è –Ω–∞—á–∞–ª–∞</label>
                                    {{ form.booking_time }}
                                    <small class="form-help">–†–∞–±–æ—á–µ–µ –≤—Ä–µ–º—è —Å 9:00 –¥–æ 21:00</small>
                                </div>

                                <div class="form-group">
                                    <label for="{{ form.duration.id_for_label }}" class="form-label">–ü—Ä–æ–¥–æ–ª–∂–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å (—á–∞—Å—ã)</label>
                                    {{ form.duration }}
                                    <small class="form-help">–ú–∏–Ω–∏–º—É–º 1 —á–∞—Å, –º–∞–∫—Å–∏–º—É–º 8 —á–∞—Å–æ–≤</small>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="form-group">
                        <label for="{{ form.location.id_for_label }}" class="form-label">–ú–µ—Å—Ç–æ —Å—ä–µ–º–∫–∏</label>
                        {{ form.location }}
                        <small class="form-help">–ê–¥—Ä–µ—Å –∏–ª–∏ –Ω–∞–∑–≤–∞–Ω–∏–µ –º–µ—Å—Ç–∞</small>
                    </div>
                </div>

                <!-- –ö–æ–Ω—Ç–∞–∫—Ç–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è -->
                <div class="form-section">
                    <h3 class="section-title">–ö–æ–Ω—Ç–∞–∫—Ç–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è</h3>

                    <div class="form-group">
                        <label for="{{ form.client_name.id_for_label }}" class="form-label">–í–∞—à–µ –∏–º—è</label>
                        {{ form.client_name }}
                    </div>

                    <div class="form-row">
                        <div class="form-group">
                            <label for="{{ form.client_phone.id_for_label }}" class="form-label">–¢–µ–ª–µ—Ñ–æ–Ω</label>
                            {{ form.client_phone }}
                        </div>

                        <div class="form-group">
                            <label for="{{ form.client_email.id_for_label }}" class="form-label">Email</label>
                            {{ form.client_email }}
                        </div>
                    </div>

                    <div class="form-group">
                        <label for="{{ form.client_message.id_for_label }}" class="form-label">–î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –ø–æ–∂–µ–ª–∞–Ω–∏—è</label>
                        {{ form.client_message }}
                        <small class="form-help">–û–ø–∏—à–∏—Ç–µ –≤–∞—à–∏ –∏–¥–µ–∏, —Å—Ç–∏–ª—å —Å—ä–µ–º–∫–∏, –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –ª—é–¥–µ–π –∏ —Ç.–¥.</small>
                    </div>
                </div>

                <!-- –£—Å–ª–æ–≤–∏—è -->
                <div class="form-section">
                    <h3 class="section-title">–ü–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ</h3>

                    <div class="form-group terms-checkbox">
                        <label class="checkbox-label">
                            {{ form.confirm_terms }}
                            <span class="checkbox-custom"></span>
                            –Ø —Å–æ–≥–ª–∞—Å–µ–Ω —Å —É—Å–ª–æ–≤–∏—è–º–∏ –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏—è –∏ –ø–æ–ª–∏—Ç–∏–∫–æ–π –∫–æ–Ω—Ñ–∏–¥–µ–Ω—Ü–∏–∞–ª—å–Ω–æ—Å—Ç–∏
                        </label>
                        {% if form.confirm_terms.errors %}
                        <div class="field-error">{{ form.confirm_terms.errors }}</div>
                        {% endif %}
                    </div>
                </div>

                <!-- –ö–Ω–æ–ø–∫–∞ –æ—Ç–ø—Ä–∞–≤–∫–∏ -->
                <div class="form-submit">
                    <button type="submit" class="submit-btn">–ó–∞–±—Ä–æ–Ω–∏—Ä–æ–≤–∞—Ç—å</button>
                </div>
            </form>
        </div>
    </div>
</div>
{% endblock %}

{% block extra_css %}

{% endblock %}

{% block extra_js %}
<script>
document.addEventListener('DOMContentLoaded', function() {
    console.log('–§–æ—Ä–º–∞ –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏—è –∑–∞–≥—Ä—É–∂–µ–Ω–∞');

    // –ü–æ–¥—Å–≤–µ—Ç–∫–∞ –≤—ã–±—Ä–∞–Ω–Ω–æ–π —É—Å–ª—É–≥–∏
    document.querySelectorAll('.service-radio').forEach(radio => {
        radio.addEventListener('change', function() {
            document.querySelectorAll('.service-option').forEach(opt => {
                opt.classList.remove('selected');
            });
            if (this.checked) {
                this.closest('.service-option').classList.add('selected');
            }
        });

        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è —Å–æ—Å—Ç–æ—è–Ω–∏—è –≤—ã–±—Ä–∞–Ω–Ω–æ–π —É—Å–ª—É–≥–∏
        if (radio.checked) {
            radio.closest('.service-option').classList.add('selected');
        }
    });

    // –ü–æ–¥—Å–≤–µ—Ç–∫–∞ –≤—ã–±—Ä–∞–Ω–Ω–æ–π –¥–∞—Ç—ã
    document.querySelectorAll('.date-radio').forEach(radio => {
        radio.addEventListener('change', function() {
            document.querySelectorAll('.date-option').forEach(opt => {
                opt.classList.remove('selected');
            });
            if (this.checked) {
                this.closest('.date-option').classList.add('selected');
            }
        });

        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è —Å–æ—Å—Ç–æ—è–Ω–∏—è –≤—ã–±—Ä–∞–Ω–Ω–æ–π –¥–∞—Ç—ã
        if (radio.checked) {
            radio.closest('.date-option').classList.add('selected');
        }
    });

    // –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –¥–æ–±–∞–≤–ª–µ–Ω–∏–µ –∫–ª–∞—Å—Å–∞ selected –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã
    document.querySelectorAll('.service-radio:checked').forEach(radio => {
        radio.closest('.service-option').classList.add('selected');
    });

    document.querySelectorAll('.date-radio:checked').forEach(radio => {
        radio.closest('.date-option').classList.add('selected');
    });

    // –°—Ç–∏–ª–∏–∑–∞—Ü–∏—è –¥–ª—è –≤–∏–∑—É–∞–ª—å–Ω–æ–≥–æ –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è –≤—ã–±–æ—Ä–∞
    const style = document.createElement('style');
    style.textContent = `
        .service-option.selected {
            border-color: #4CAF50;
            background: rgba(76, 175, 80, 0.1);
        }

        .date-option.selected {
            background: #333;
            border-color: #4CAF50;
        }
    `;
    document.head.appendChild(style);
});
</script>
{% endblock %}